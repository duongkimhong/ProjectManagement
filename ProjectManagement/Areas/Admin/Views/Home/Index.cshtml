@using Microsoft.EntityFrameworkCore
@using Microsoft.AspNetCore.Identity
@using ProjectManagement.Models

@inject SignInManager<ProjectManagement.Models.ApplicationUser> SignInManager
@inject UserManager<ProjectManagement.Models.ApplicationUser> UserManager
@inject ApplicationDbContext _context

@{
	ViewData["Title"] = "Admin Index";
	Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

<style>
	.avatar-container {
		width: 50px;
		height: 50px;
		border-radius: 50%;
		overflow: hidden;
	}

	.avatar {
		width: 100%;
		height: auto;
		display: block;
	}
</style>

@{
	var accounts = UserManager.Users.ToList();
	var projects = _context.Projects.Where(p => p.Status != ProjectStatus.Cancelled).ToList();
}

<!-- Body: Body -->
<div class="body d-flex py-lg-3 py-md-2">
	<div class="container-xxl">
		<div class="row align-items-center">
			<div class="border-0 mb-4">
				<div class="card-header py-3 no-bg bg-transparent d-flex align-items-center px-0 justify-content-between border-bottom flex-wrap">
					<h3 class="fw-bold py-3 mb-0">Dashboard</h3>
					<div class="d-flex py-2 project-tab flex-wrap w-sm-100">
					</div>
				</div>
			</div>
		</div> <!-- Row end  -->
		<div class="card mb-3">
			<div class="card-header py-3  bg-transparent border-bottom-0">
				<h6 class="mb-0 fw-bold ">Projects</h6>
			</div>
			<div class="card-body">
				<table id="patient-table" class="table table-hover align-middle mb-0" style="width: 100%;">
					<thead>
						<tr>
							<th>#</th>
							<th>Icon</th>
							<th>Project Name</th>
							<th>StartDate</th>
							<th>EndDate</th>
							<th>Status</th>
							<th>Action</th>
						</tr>
					</thead>
					<tbody>
						@{
							int i = 1;
						}
						@foreach (var project in projects)
						{
							<tr>
								<td>@i</td>
								<td class="text-center align-middle">
									<div class="p-1 border" style="width: 50px; height: 50px; overflow: hidden;">
										<img src="@project.Image" class="img-fluid" alt="profile-image">
									</div>
								</td>
								<td>@project.Name</td>
								<td>@(project.StartDate.HasValue ? project.StartDate.Value.ToString("dd/MM/yyyy") : "")</td>
								<td>@(project.EndDate.HasValue ? project.EndDate.Value.ToString("dd/MM/yyyy") : "")</td>
								<td>@project.Status</td>
								<td>
									<div class="btn-group" role="group" aria-label="Basic outlined example">
										<button type="button" class="btn btn-outline-secondary editButton" onclick="openEditModal('@project.Id')">
											<i class="icofont-edit text-success"></i>
										</button>
										<button type="button" class="btn btn-outline-secondary deleterow" data-toggle="modal" data-target="#deleteConfirmationModal" data-id="@project.Id"><i class="icofont-ui-delete text-danger"></i></button>
									</div>
								</td>
							</tr>
							i++;
						}
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>


<!-- Modal -->
<!-- Modal popup để chỉnh sửa Project -->
<div class="modal fade" id="editProjectModal" tabindex="-1" role="dialog" aria-labelledby="editProjectModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content" style="width: 600px;">
			<div class="modal-header">
				<h5 class="modal-title" id="editIssueModalLabel">Edit Issue</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<!-- Form để chỉnh sửa project -->
				<form id="editProjectForm">
					<div class="row g-3 align-items-center">
						@* <div id="editProjectContainer"> *@
						<div class="mb-3">
							<label for="projectName" class="form-label">Project Name</label>
							<input type="text" class="form-control" id="projectName" name="projectName" onkeypress="handleKeyPress(event)">
						</div>

						<div class="form-group">
							<label for="projectImage" class="form-label">Hình ảnh</label>
							<input type="file" class="form-control" id="projectImageInput" accept="image/*" onchange="updateProjectImage(event)" />
						</div>

						<div class="text-center mt-2">
							<img id="projectImagePreview" src="" style="max-width: 100px; max-height: 100px;" />
						</div>

						<!-- description -->
						<div class="col-md-10">
							<label class="form-label">Description</label>
							<textarea type="text" class="form-control" id="projectDescription" name="projectDescription"></textarea>
						</div>
						<div class="col-md-2" style="margin-top: 45px;">
							<button type="button" class="btn btn-success" style="width: 80px; margin-bottom: 5px;" onclick="updateProjectDescription()">Save</button><br>
							<button type="button" class="btn btn-danger" style="width: 80px;" onclick="cancelUpdate()">Cancel</button>
						</div>

						<!-- startdate endate -->
						<div class="col-md-6">
							<label for="projectStartDate" class="form-label">Start Date</label>
							<input type="date" class="form-control" id="projectStartDate" name="projectStartDate">
						</div>
						<div class="col-md-6">
							<label for="projectEndDate" class="form-label">End Date</label>
							<input type="date" class="form-control" id="projectEndDate" name="projectEndDate">
						</div>

						<!-- document -->
						<div class="col-md-12">
							<label for="documents" class="form-label">Documents</label>
							<div id="documentList">
								<!-- Danh sách tài liệu sẽ được cập nhật bằng JavaScript -->
							</div>
							<div>
								<input type="file" id="fileInput" class="form-control" multiple onchange="uploadFiles(this.files)" />
							</div>
						</div>
						<div class="mb-3">
							<label>Team Members</label>
							<div id="teamMembersContainer">
								<!-- Content will be dynamically populated by JavaScript -->
							</div>
							<input type="hidden" id="editSelectedUsersInput" name="editSelectedUsers" />
							<button type="button" class="btn btn-primary" id="editInviteButton" onclick="openInviteModal()">Invite</button>
						</div>
						@* </div> *@
					</div>
				</form>
			</div>
		</div>
	</div>
</div>

<!-- Modal Popup for Invite -->
<div class="modal fade" id="editInviteModal" tabindex="-1" aria-labelledby="editInviteModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="editInviteModalLabel">Invite Users</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<h6>List of available users to invite:</h6>
				<table class="table">
					<thead>
						<tr>
							<th scope="col">Username</th>
							<th scope="col">Select</th>
						</tr>
					</thead>
					<tbody id="editInviteModalBody">
						<!-- Content will be dynamically populated by JavaScript -->
					</tbody>
				</table>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
				<button type="button" class="btn btn-primary" id="inviteButtonInModal" onclick="inviteUsers()">Invite</button>
			</div>
		</div>
	</div>
</div>


<!-- Modal Popup for Delete Confirmation -->
<div class="modal fade" id="deleteConfirmationModal" tabindex="-1" aria-labelledby="deleteConfirmationModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="deleteConfirmationModalLabel">Confirm Delete</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				Are you sure you want to delete this project?
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
				<button type="button" class="btn btn-danger" id="confirmDelete">Delete</button>
			</div>
		</div>
	</div>
</div>

<!-- Modal xác nhận xóa file -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="confirmDeleteModalLabel">Confirm Delete</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<p>Are you sure you want to delete this document?</p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
				<button type="button" class="btn btn-danger" id="confirmDeleteBtn" onclick="confirmDeleteBtn()">Delete</button>
			</div>
		</div>
	</div>
</div>

<!-- jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<!-- Bootstrap JS -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script src="~/js/home_script.js"></script>

